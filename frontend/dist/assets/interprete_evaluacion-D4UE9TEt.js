import{d as X,r as s,o as Y,m as ee,a as c,b as e,e as b,h as te,t as f,k as C,p as U,w as ae,T as se,q as oe,s as le,f as v,_ as ne}from"./index-D3H61wzk.js";import{b as re}from"./activitys.service-DBaMfr93.js";import{r as ie,b as de,s as ue,c as ce,d as ve}from"./code.service-kyNGy16t.js";import{c as g,E as me,l as pe,h as be,k as fe,a as ge,i as xe,b as he,p as we,o as ke,d as ye,e as Ce,f as Ee}from"./index-UlJKtRD1.js";const _e={class:"min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900"},Me={class:"relative flex min-h-screen flex-col"},je={class:"border-b border-white/10 bg-slate-950/30 backdrop-blur-sm shadow-lg"},Le={class:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8"},Be={class:"flex h-20 items-center justify-between"},Te={class:"flex items-center gap-3"},ze={key:0,class:"text-sm text-slate-400"},Se={class:"relative flex-grow w-full px-3 sm:px-4 lg:px-6 py-6 grid gap-4 md:grid-cols-[22rem_minmax(0,1fr)] lg:grid-cols-[26rem_minmax(0,1fr)]"},Ie={class:"hidden md:block"},De={class:"sticky top-4 rounded-2xl border border-white/10 bg-slate-950/40 backdrop-blur-md shadow-2xl p-6"},Ae={key:0,class:"animate-pulse space-y-3"},Ne={key:1,class:"text-sm text-slate-300 whitespace-pre-wrap leading-relaxed"},Ve={class:"flex flex-col gap-4"},Re={class:"flex flex-col gap-3"},Fe={class:"rounded-2xl border border-white/10 bg-slate-950/40 backdrop-blur-md shadow-2xl p-6 relative"},Ue={key:0,class:"absolute inset-0 bg-slate-950/70 backdrop-blur-sm rounded-2xl z-10 flex items-center justify-center"},He={class:"flex items-center justify-between mb-4"},Pe={class:"flex items-center gap-2"},qe=["disabled"],We=["disabled"],$e=["disabled"],Ge={class:"flex flex-col gap-3"},Ke={class:"rounded-2xl border border-white/10 bg-slate-950/40 backdrop-blur-md shadow-2xl p-6"},Oe={class:"flex items-center gap-2 mb-4"},Ze={key:0,class:"fixed inset-0 z-50 flex items-center justify-center"},Je={key:1,class:"fixed inset-0 z-50 flex items-center justify-center"},Qe={key:0,class:"fixed bottom-8 left-1/2 -translate-x-1/2 z-50"},Xe=X({__name:"interprete_evaluacion",setup(Ye){const B=oe(),u=s(null),x=s(!0),o=s(!1),m=s(`
print("Hola mundo")

`),d=s(""),r=s(!1),E=s(null);let p=null;const T=s(0),z=s(0),S=s(0),I=s(0),D=s(0),_=s(null),h=s(!1),M=s(0),w=s(null),j=s(0),L=s(!1),i=s(!1),k=s(!1);function H(){k.value=!0}function A(){k.value=!1}async function P(){k.value=!1,await Z()}async function q(){document.documentElement.requestFullscreen()}async function N(){try{document.fullscreenElement&&await document.exitFullscreen()}catch(a){console.error("Error al salir de pantalla completa:",a)}}function V(){!document.fullscreenElement&&i.value&&(h.value=!0,console.warn("Usuario salió de pantalla completa"))}async function W(){L.value=!1,i.value=!0,_.value=Date.now(),console.log("Evaluación iniciada"),await q()}function $(){console.log("Inicio de evaluación cancelado"),window.history.back()}function R(){M.value++,w.value=Date.now(),console.log(`Cambio de ventana detectado. Total: ${M.value}`)}function F(){if(w.value){const a=Math.round((Date.now()-w.value)/1e3);j.value+=a,console.log(`Usuario regresó después de ${a} segundos. Tiempo total de inactividad: ${j.value}s`),w.value=null}}async function G(){x.value=!0,u.value=null;const a=Number(B.params.id);try{u.value=await re(a),L.value=!0}catch(t){console.log("Error al cargar la evaluación:",t)}finally{x.value=!1}}async function K(){if(!(o.value||!i.value)){o.value=!0;try{I.value++;const a=await ie(m.value);if(!a.ok){console.log("Error en la respuesta de /code-run/:",a.statusText);return}const t=await a.json();console.log("Respuesta de /run-code/:",t),t.stderr?(d.value=t.stderr,r.value=!0):(d.value=t.stdout,r.value=!1)}catch(a){console.log("Error al llamar /run-code/:",a)}finally{o.value=!1}}}async function O(){if(!(o.value||!i.value)){o.value=!0;try{D.value++;const a=await de(m.value,u.value?.id);if(!a.ok){console.log("Error en la respuesta de /run-evaluacion-test/:",a.statusText);return}const t=await a.json();console.log("Respuesta de /run-evaluacion-test/:",t),t.stderr?(d.value=t.stderr,r.value=!0):(d.value=t.stdout,r.value=!1)}catch(a){console.log("Error al correr los tests:",a)}finally{o.value=!1}}}async function Z(){const a=Number(B.params.id);if(!(o.value||!i.value)){o.value=!0;try{const t=await ue(m.value,u.value?.id);if(!t.ok){console.log("Error en la respuesta de /send-code/:",t.statusText),d.value="Error al enviar el código",r.value=!0;return}const l=await t.json();if(console.log("Respuesta de /send-code/:",l),l.return_code===0&&l.score!==void 0){h.value&&(l.score=0);const y=await ce(l.score,a);y.ok?console.log("Nota enviada al LMS:",l.score):console.error("Error al enviar la nota al LMS:",y.statusText);try{const n=await le(),J=_.value?Math.round((Date.now()-_.value)/1e3):0,Q={id_evaluacion:u.value?.id,id_alumno:n.userId,nota:l.score,codigo:m.value,detalles:{intentos_copiar:T.value,intentos_pegar:z.value,intentos_cortar:S.value,salio_pantalla_completa:h.value,cambios_ventana:M.value,tiempo_inactividad_segundos:j.value,ejecuciones_codigo:I.value,ejecuciones_tests:D.value,tiempo_total_segundos:J,timestamp:new Date().toISOString()}};await ve(Q),console.log("Entrega registrada en la base de datos")}catch(n){console.error("Error al registrar la entrega:",n)}}l.stderr?(d.value=l.stderr,r.value=!0):(d.value=l.stdout,r.value=!1),await N(),setTimeout(()=>{window.close()},1e3)}catch(t){console.log("Error al enviar el código:",t),d.value="Error al conectar con el servidor",r.value=!0}finally{o.value=!1}}}return Y(()=>{const t=new URLSearchParams(window.location.search).get("ltik");if(t&&sessionStorage.setItem("ltik",t),G(),window.addEventListener("blur",R),window.addEventListener("focus",F),document.addEventListener("fullscreenchange",V),E.value&&!p){const l=g.domEventHandlers({paste:n=>(n.preventDefault(),z.value++,!0),copy:n=>(n.preventDefault(),T.value++,!0),cut:n=>(n.preventDefault(),S.value++,!0)}),y=me.create({doc:m.value,extensions:[pe(),be(),fe.of([...ye,...Ce,{key:"Tab",preventDefault:!0,run:Ee}]),ge(),xe(),he(),we(),ke,g.lineWrapping,l,g.updateListener.of(n=>{n.docChanged&&(m.value=n.state.doc.toString())}),g.theme({"&":{height:"65vh",borderRadius:"0.75rem",border:"1px solid rgba(148, 163, 184, 0.1)",backgroundColor:"rgba(15, 23, 42, 0.6)"},".cm-scroller":{fontFamily:'ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace',fontSize:"1rem"},".cm-gutters":{backgroundColor:"rgba(15, 23, 42, 0.4)",borderRight:"1px solid rgba(148, 163, 184, 0.1)"}})]});p=new g({state:y,parent:E.value})}}),ee(()=>{p&&(p.destroy(),p=null),window.removeEventListener("blur",R),window.removeEventListener("focus",F),document.removeEventListener("fullscreenchange",V),document.fullscreenElement&&N()}),(a,t)=>(v(),c("div",_e,[t[18]||(t[18]=e("div",{class:"absolute inset-0 overflow-hidden pointer-events-none"},[e("div",{class:"absolute top-20 left-10 w-72 h-72 bg-emerald-500/10 rounded-full blur-3xl"}),e("div",{class:"absolute bottom-20 right-10 w-96 h-96 bg-sky-500/10 rounded-full blur-3xl"}),e("div",{class:"absolute top-1/2 left-1/2 w-80 h-80 bg-purple-500/5 rounded-full blur-3xl"})],-1)),e("div",Me,[e("header",je,[e("div",Le,[e("div",Be,[e("div",Te,[t[1]||(t[1]=e("div",{class:"bg-gradient-to-br from-emerald-400 to-teal-600 p-2 rounded-xl shadow-lg"},[e("svg",{class:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})])],-1)),e("div",null,[t[0]||(t[0]=e("h1",{class:"text-2xl font-bold bg-gradient-to-r from-emerald-400 to-teal-500 bg-clip-text text-transparent"}," Intérprete de Python ",-1)),u.value?(v(),c("p",ze,f(u.value.titulo),1)):b("",!0)])])])])]),e("main",Se,[e("aside",Ie,[e("div",De,[t[3]||(t[3]=C('<div class="flex items-center gap-2 mb-4" data-v-a78db092><div class="bg-gradient-to-br from-amber-400 to-orange-600 p-2 rounded-lg shadow-lg" data-v-a78db092><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-a78db092><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" data-v-a78db092></path></svg></div><h2 class="text-lg font-semibold text-white" data-v-a78db092>Enunciado</h2></div>',1)),x.value?(v(),c("div",Ae,t[2]||(t[2]=[e("div",{class:"h-4 w-5/6 rounded bg-slate-700/50"},null,-1),e("div",{class:"h-4 w-4/6 rounded bg-slate-700/50"},null,-1),e("div",{class:"h-4 w-3/6 rounded bg-slate-700/50"},null,-1),e("div",{class:"h-4 w-2/6 rounded bg-slate-700/50"},null,-1)]))):(v(),c("p",Ne,f(u.value?.contenido),1))])]),e("div",Ve,[e("section",Re,[e("div",Fe,[i.value?b("",!0):(v(),c("div",Ue,t[4]||(t[4]=[e("div",{class:"text-center"},[e("svg",{class:"w-16 h-16 text-slate-400 mx-auto mb-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})]),e("p",{class:"text-slate-300 font-medium"},"Debes iniciar la evaluación para comenzar")],-1)]))),e("div",He,[t[8]||(t[8]=C('<div class="flex items-center gap-2" data-v-a78db092><div class="bg-gradient-to-br from-sky-400 to-blue-600 p-2 rounded-lg shadow-lg" data-v-a78db092><svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-a78db092><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" data-v-a78db092></path></svg></div><span class="text-lg font-semibold text-white" data-v-a78db092>Editor de Código</span></div>',1)),e("div",Pe,[e("button",{class:"inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-sky-600 to-blue-700 px-4 py-2.5 text-white text-sm font-medium hover:from-sky-500 hover:to-blue-600 transition-all duration-200 hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",disabled:o.value||!i.value,onClick:K},[t[5]||(t[5]=e("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polygon",{points:"8,5 19,12 8,19"})],-1)),e("span",null,f(o.value?"Ejecutando…":"Ejecutar"),1)],8,qe),e("button",{class:"inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-purple-600 to-indigo-700 px-4 py-2.5 text-white text-sm font-medium hover:from-purple-500 hover:to-indigo-600 transition-all duration-200 hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",disabled:o.value||!i.value,onClick:O},t[6]||(t[6]=[e("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M9 11l3 3L22 4"}),e("path",{d:"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"})],-1),e("span",null,"Correr Tests",-1)]),8,We),e("button",{class:"inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-emerald-600 to-teal-700 px-4 py-2.5 text-white text-sm font-medium hover:from-emerald-500 hover:to-teal-600 transition-all duration-200 hover:scale-105 shadow-lg disabled:opacity-50 disabled:cursor-not-allowed",disabled:o.value||!i.value,onClick:H},[t[7]||(t[7]=e("svg",{class:"w-4 h-4",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M22 3L9 14"}),e("path",{d:"M22 3l-7 18-3-7-7-3 17-8Z"})],-1)),e("span",null,f(o.value?"Enviando...":"Enviar"),1)],8,$e)])]),e("div",{ref_key:"codeMirrorContainer",ref:E,class:"w-full"},null,512)])]),e("section",Ge,[e("div",Ke,[e("div",Oe,[e("div",{class:U(["p-2 rounded-lg shadow-lg",r.value?"bg-gradient-to-br from-rose-400 to-red-600":"bg-gradient-to-br from-slate-400 to-slate-600"])},t[9]||(t[9]=[e("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)]),2),t[10]||(t[10]=e("span",{class:"text-lg font-semibold text-white"},"Terminal",-1))]),e("pre",{class:U(["h-[220px] w-full overflow-auto rounded-lg border p-4 text-sm font-mono",r.value?"border-rose-500/50 bg-rose-950/50 text-rose-200":"border-slate-700/50 bg-slate-900/50 text-slate-100"])},f(d.value||"—"),3)])])])])]),L.value&&!x.value?(v(),c("div",Ze,[t[14]||(t[14]=e("div",{class:"absolute inset-0 bg-slate-950/90 backdrop-blur-md"},null,-1)),e("div",{class:"relative mx-4 w-full max-w-2xl rounded-2xl border border-white/10 bg-slate-950/95 backdrop-blur-md shadow-2xl p-8"},[t[13]||(t[13]=C('<div class="flex items-center gap-3 mb-6" data-v-a78db092><div class="bg-gradient-to-br from-blue-400 to-indigo-600 p-3 rounded-xl shadow-lg" data-v-a78db092><svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-a78db092><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" data-v-a78db092></path></svg></div><h3 class="text-2xl font-bold text-white" data-v-a78db092>Comenzar Evaluación</h3></div><div class="mb-6 space-y-4" data-v-a78db092><div class="p-5 rounded-xl bg-amber-500/10 border border-amber-500/30" data-v-a78db092><div class="flex items-start gap-3" data-v-a78db092><svg class="w-6 h-6 text-amber-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-a78db092><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" data-v-a78db092></path></svg><div class="flex-1" data-v-a78db092><h5 class="text-base font-semibold text-amber-300 mb-2" data-v-a78db092>Instrucciones importantes:</h5><ul class="space-y-2 text-sm text-amber-200/90" data-v-a78db092><li class="flex items-start gap-2" data-v-a78db092><span class="text-amber-400 font-bold" data-v-a78db092>•</span><span data-v-a78db092>La pantalla se pondrá en modo pantalla completa automáticamente</span></li><li class="flex items-start gap-2" data-v-a78db092><span class="text-red-400 font-bold" data-v-a78db092>⚠️</span><span class="font-semibold text-red-300" data-v-a78db092>Si sales de pantalla completa, la prueba será INVALIDADA</span></li><li class="flex items-start gap-2" data-v-a78db092><span class="text-amber-400 font-bold" data-v-a78db092>•</span><span data-v-a78db092>No podrás copiar ni pegar código en el editor</span></li><li class="flex items-start gap-2" data-v-a78db092><span class="text-amber-400 font-bold" data-v-a78db092>•</span><span data-v-a78db092>Se registrarán los cambios de ventana o pestaña y el tiempo fuera de la ventana</span></li><li class="flex items-start gap-2" data-v-a78db092><span class="text-amber-400 font-bold" data-v-a78db092>•</span><span data-v-a78db092>Una vez iniciada, todas tus acciones serán monitoreadas</span></li><li class="flex items-start gap-2" data-v-a78db092><span class="text-amber-400 font-bold" data-v-a78db092>•</span><span data-v-a78db092>Asegúrate de estar listo antes de continuar</span></li></ul></div></div></div></div>',2)),e("div",{class:"flex justify-end gap-3"},[e("button",{class:"inline-flex items-center gap-2 rounded-lg px-5 py-3 text-sm font-medium text-slate-200 hover:bg-white/10 hover:text-white transition-all duration-200 border border-slate-700 hover:border-slate-500",onClick:$},t[11]||(t[11]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),e("span",null,"Cancelar",-1)])),e("button",{class:"inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-blue-600 to-indigo-700 px-5 py-3 text-white text-sm font-medium hover:from-blue-500 hover:to-indigo-600 transition-all duration-200 hover:scale-105 shadow-lg",onClick:W},t[12]||(t[12]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),e("span",null,"Estoy listo, comenzar",-1)]))])])])):b("",!0),k.value?(v(),c("div",Je,[e("div",{class:"absolute inset-0 bg-slate-950/80 backdrop-blur-sm",onClick:A}),e("div",{class:"relative mx-4 w-full max-w-md rounded-2xl border border-white/10 bg-slate-950/90 backdrop-blur-md shadow-2xl p-6"},[t[16]||(t[16]=C('<div class="flex items-center gap-3 mb-4" data-v-a78db092><div class="bg-gradient-to-br from-emerald-400 to-teal-600 p-2 rounded-lg shadow-lg" data-v-a78db092><svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" data-v-a78db092><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" data-v-a78db092></path></svg></div><h3 class="text-xl font-bold text-white" data-v-a78db092>Enviar evaluación</h3></div><p class="text-sm text-slate-300 mb-6" data-v-a78db092> ¿Confirmas que deseas enviar tu solución para esta evaluación? Esta acción será registrada. </p>',2)),e("div",{class:"flex justify-end gap-3"},[e("button",{class:"inline-flex items-center gap-2 rounded-lg px-4 py-2.5 text-sm font-medium text-slate-200 hover:bg-white/10 hover:text-white transition-all duration-200",onClick:A}," Cancelar "),e("button",{class:"inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-emerald-600 to-teal-700 px-4 py-2.5 text-white text-sm font-medium hover:from-emerald-500 hover:to-teal-600 transition-all duration-200 hover:scale-105 shadow-lg",onClick:P},t[15]||(t[15]=[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),e("span",null,"Confirmar",-1)]))])])])):b("",!0),te(se,{"enter-active-class":"transition ease-out duration-300","enter-from-class":"transform translate-y-full opacity-0","enter-to-class":"transform translate-y-0 opacity-100","leave-active-class":"transition ease-in duration-200","leave-from-class":"transform translate-y-0 opacity-100","leave-to-class":"transform translate-y-full opacity-0"},{default:ae(()=>[h.value&&i.value?(v(),c("div",Qe,t[17]||(t[17]=[e("div",{class:"mx-4 rounded-xl border border-red-500/50 bg-red-950/90 backdrop-blur-md shadow-2xl p-4 max-w-md"},[e("div",{class:"flex items-center gap-3"},[e("div",{class:"bg-red-500 p-2 rounded-lg shadow-lg flex-shrink-0"},[e("svg",{class:"w-5 h-5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})])]),e("div",{class:"flex-1"},[e("h4",{class:"text-sm font-semibold text-red-200 mb-1"},"⚠️ PRUEBA INVALIDADA"),e("p",{class:"text-xs text-red-300"}," Saliste de pantalla completa. La evaluación será invalidada. ")])])],-1)]))):b("",!0)]),_:1})]))}}),ot=ne(Xe,[["__scopeId","data-v-a78db092"]]);export{ot as default};
