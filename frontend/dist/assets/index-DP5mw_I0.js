import{c as S,V as ge,S as J,g as M,P as Ee,j as k,F as Z,m as I,D as p,s as X,n as ee,q as Ie,r as qe,t as Te,C as b,E as pe,R as xe,u as Oe,v as ye,w as $e,W as Be,l as ze,h as He,x as Ke,a as Ne,y as _e,z as Qe,A as Ve,i as je,B as Ge,b as Ue,G as Ye,H as Je,I as Ze,J as Xe,K as et,k as tt,L as it,M as nt,d as st,e as rt,N as ot,O as lt}from"./index-UlJKtRD1.js";function u(){var t=arguments[0];typeof t=="string"&&(t=document.createElement(t));var e=1,i=arguments[1];if(i&&typeof i=="object"&&i.nodeType==null&&!Array.isArray(i)){for(var n in i)if(Object.prototype.hasOwnProperty.call(i,n)){var s=i[n];typeof s=="string"?t.setAttribute(n,s):s!=null&&(t[n]=s)}e++}for(;e<arguments.length;e++)be(t,arguments[e]);return t}function be(t,e){if(typeof e=="string")t.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)t.appendChild(e);else if(Array.isArray(e))for(var i=0;i<e.length;i++)be(t,e[i]);else throw new RangeError("Unsupported child node: "+e)}const le=typeof String.prototype.normalize=="function"?t=>t.normalize("NFKD"):t=>t;class P{constructor(e,i,n=0,s=e.length,r,o){this.test=o,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,s),this.bufferStart=n,this.normalize=r?l=>r(le(l)):le,this.query=this.normalize(i)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Ie(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let i=Te(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=qe(e);let s=this.normalize(i);if(s.length)for(let r=0,o=n;;r++){let l=s.charCodeAt(r),a=this.match(l,o,this.bufferPos+this.bufferStart);if(r==s.length-1){if(a)return this.value=a,this;break}o==n&&r<i.length&&i.charCodeAt(r)==l&&o++}}}match(e,i,n){let s=null;for(let r=0;r<this.matches.length;r+=2){let o=this.matches[r],l=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?s={from:this.matches[r+1],to:n}:(this.matches[r]++,l=!0)),l||(this.matches.splice(r,2),r-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?s={from:i,to:n}:this.matches.push(1,i)),s&&this.test&&!this.test(s.from,s.to,this.buffer,this.bufferStart)&&(s=null),s}}typeof Symbol<"u"&&(P.prototype[Symbol.iterator]=function(){return this});const Se={from:-1,to:-1,match:/.*/.exec("")},te="gm"+(/x/.unicode==null?"":"u");class ke{constructor(e,i,n,s=0,r=e.length){if(this.text=e,this.to=r,this.curLine="",this.done=!1,this.value=Se,/\\[sWDnr]|\n|\r|\[\^/.test(i))return new ve(e,i,n,s,r);this.re=new RegExp(i,te+(n?.ignoreCase?"i":"")),this.test=n?.test,this.iter=e.iter();let o=e.lineAt(s);this.curLineStart=o.from,this.matchPos=K(e,s),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let i=this.matchPos<=this.to&&this.re.exec(this.curLine);if(i){let n=this.curLineStart+i.index,s=n+i[0].length;if(this.matchPos=K(this.text,s+(n==s?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<s||n>this.value.to)&&(!this.test||this.test(n,s,i)))return this.value={from:n,to:s,match:i},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const j=new WeakMap;class D{constructor(e,i){this.from=e,this.text=i}get to(){return this.from+this.text.length}static get(e,i,n){let s=j.get(e);if(!s||s.from>=n||s.to<=i){let l=new D(i,e.sliceString(i,n));return j.set(e,l),l}if(s.from==i&&s.to==n)return s;let{text:r,from:o}=s;return o>i&&(r=e.sliceString(i,o)+r,o=i),s.to<n&&(r+=e.sliceString(s.to,n)),j.set(e,new D(o,r)),new D(i,r.slice(i-o,n-o))}}class ve{constructor(e,i,n,s,r){this.text=e,this.to=r,this.done=!1,this.value=Se,this.matchPos=K(e,s),this.re=new RegExp(i,te+(n?.ignoreCase?"i":"")),this.test=n?.test,this.flat=D.get(e,s,this.chunkEnd(s+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,i=this.re.exec(this.flat.text);if(i&&!i[0]&&i.index==e&&(this.re.lastIndex=e+1,i=this.re.exec(this.flat.text)),i){let n=this.flat.from+i.index,s=n+i[0].length;if((this.flat.to>=this.to||i.index+i[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,s,i)))return this.value={from:n,to:s,match:i},this.matchPos=K(this.text,s+(n==s?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=D.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(ke.prototype[Symbol.iterator]=ve.prototype[Symbol.iterator]=function(){return this});function at(t){try{return new RegExp(t,te),!0}catch{return!1}}function K(t,e){if(e>=t.length)return e;let i=t.lineAt(e),n;for(;e<i.to&&(n=i.text.charCodeAt(e-i.from))>=56320&&n<57344;)e++;return e}function U(t){let e=String(t.state.doc.lineAt(t.state.selection.main.head).number),i=u("input",{class:"cm-textfield",name:"line",value:e}),n=u("form",{class:"cm-gotoLine",onkeydown:r=>{r.keyCode==27?(r.preventDefault(),t.dispatch({effects:E.of(!1)}),t.focus()):r.keyCode==13&&(r.preventDefault(),s())},onsubmit:r=>{r.preventDefault(),s()}},u("label",t.state.phrase("Go to line"),": ",i)," ",u("button",{class:"cm-button",type:"submit"},t.state.phrase("go")),u("button",{name:"close",onclick:()=>{t.dispatch({effects:E.of(!1)}),t.focus()},"aria-label":t.state.phrase("close"),type:"button"},["×"]));function s(){let r=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(i.value);if(!r)return;let{state:o}=t,l=o.doc.lineAt(o.selection.main.head),[,a,h,c,f]=r,m=c?+c.slice(1):0,g=h?+h:l.number;if(h&&f){let v=g/100;a&&(v=v*(a=="-"?-1:1)+l.number/o.doc.lines),g=Math.round(o.doc.lines*v)}else h&&a&&(g=g*(a=="-"?-1:1)+l.number);let C=o.doc.line(Math.max(1,Math.min(o.doc.lines,g))),d=k.cursor(C.from+Math.max(0,Math.min(m,C.length)));t.dispatch({effects:[E.of(!1),S.scrollIntoView(d.from,{y:"center"})],selection:d}),t.focus()}return{dom:n}}const E=M.define(),ae=J.define({create(){return!0},update(t,e){for(let i of e.effects)i.is(E)&&(t=i.value);return t},provide:t=>X.from(t,e=>e?U:null)}),ct=t=>{let e=I(t,U);if(!e){let i=[E.of(!0)];t.state.field(ae,!1)==null&&i.push(M.appendConfig.of([ae,ht])),t.dispatch({effects:i}),e=I(t,U)}return e&&e.dom.querySelector("input").select(),!0},ht=S.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px",position:"relative","& label":{fontSize:"80%"},"& [name=close]":{position:"absolute",top:"0",bottom:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:"0"}}}),ft={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},ut=Z.define({combine(t){return ee(t,ft,{highlightWordAroundCursor:(e,i)=>e||i,minSelectionLength:Math.min,maxMatches:Math.min})}});function dt(t){return[yt,xt]}const mt=p.mark({class:"cm-selectionMatch"}),gt=p.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function ce(t,e,i,n){return(i==0||t(e.sliceDoc(i-1,i))!=b.Word)&&(n==e.doc.length||t(e.sliceDoc(n,n+1))!=b.Word)}function pt(t,e,i,n){return t(e.sliceDoc(i,i+1))==b.Word&&t(e.sliceDoc(n-1,n))==b.Word}const xt=ge.fromClass(class{constructor(t){this.decorations=this.getDeco(t)}update(t){(t.selectionSet||t.docChanged||t.viewportChanged)&&(this.decorations=this.getDeco(t.view))}getDeco(t){let e=t.state.facet(ut),{state:i}=t,n=i.selection;if(n.ranges.length>1)return p.none;let s=n.main,r,o=null;if(s.empty){if(!e.highlightWordAroundCursor)return p.none;let a=i.wordAt(s.head);if(!a)return p.none;o=i.charCategorizer(s.head),r=i.sliceDoc(a.from,a.to)}else{let a=s.to-s.from;if(a<e.minSelectionLength||a>200)return p.none;if(e.wholeWords){if(r=i.sliceDoc(s.from,s.to),o=i.charCategorizer(s.head),!(ce(o,i,s.from,s.to)&&pt(o,i,s.from,s.to)))return p.none}else if(r=i.sliceDoc(s.from,s.to),!r)return p.none}let l=[];for(let a of t.visibleRanges){let h=new P(i.doc,r,a.from,a.to);for(;!h.next().done;){let{from:c,to:f}=h.value;if((!o||ce(o,i,c,f))&&(s.empty&&c<=s.from&&f>=s.to?l.push(gt.range(c,f)):(c>=s.to||f<=s.from)&&l.push(mt.range(c,f)),l.length>e.maxMatches))return p.none}}return p.set(l)}},{decorations:t=>t.decorations}),yt=S.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),bt=({state:t,dispatch:e})=>{let{selection:i}=t,n=k.create(i.ranges.map(s=>t.wordAt(s.head)||k.cursor(s.head)),i.mainIndex);return n.eq(i)?!1:(e(t.update({selection:n})),!0)};function St(t,e){let{main:i,ranges:n}=t.selection,s=t.wordAt(i.head),r=s&&s.from==i.from&&s.to==i.to;for(let o=!1,l=new P(t.doc,e,n[n.length-1].to);;)if(l.next(),l.done){if(o)return null;l=new P(t.doc,e,0,Math.max(0,n[n.length-1].from-1)),o=!0}else{if(o&&n.some(a=>a.from==l.value.from))continue;if(r){let a=t.wordAt(l.value.from);if(!a||a.from!=l.value.from||a.to!=l.value.to)continue}return l.value}}const kt=({state:t,dispatch:e})=>{let{ranges:i}=t.selection;if(i.some(r=>r.from===r.to))return bt({state:t,dispatch:e});let n=t.sliceDoc(i[0].from,i[0].to);if(t.selection.ranges.some(r=>t.sliceDoc(r.from,r.to)!=n))return!1;let s=St(t,n);return s?(e(t.update({selection:t.selection.addRange(k.range(s.from,s.to),!1),effects:S.scrollIntoView(s.to)})),!0):!1},F=Z.define({combine(t){return ee(t,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new Et(e),scrollToMatch:e=>S.scrollIntoView(e)})}});class Ce{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||at(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(i,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new wt(this):new Ct(this)}getCursor(e,i=0,n){let s=e.doc?e:pe.create({doc:e});return n==null&&(n=s.doc.length),this.regexp?R(this,s,i,n):A(this,s,i,n)}}class Me{constructor(e){this.spec=e}}function A(t,e,i,n){return new P(e.doc,t.unquoted,i,n,t.caseSensitive?void 0:s=>s.toLowerCase(),t.wholeWord?vt(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function vt(t,e){return(i,n,s,r)=>((r>i||r+s.length<n)&&(r=Math.max(0,i-2),s=t.sliceString(r,Math.min(t.length,n+2))),(e(N(s,i-r))!=b.Word||e(_(s,i-r))!=b.Word)&&(e(_(s,n-r))!=b.Word||e(N(s,n-r))!=b.Word))}class Ct extends Me{constructor(e){super(e)}nextMatch(e,i,n){let s=A(this.spec,e,n,e.doc.length).nextOverlapping();if(s.done){let r=Math.min(e.doc.length,i+this.spec.unquoted.length);s=A(this.spec,e,0,r).nextOverlapping()}return s.done||s.value.from==i&&s.value.to==n?null:s.value}prevMatchInRange(e,i,n){for(let s=n;;){let r=Math.max(i,s-1e4-this.spec.unquoted.length),o=A(this.spec,e,r,s),l=null;for(;!o.nextOverlapping().done;)l=o.value;if(l)return l;if(r==i)return null;s-=1e4}}prevMatch(e,i,n){let s=this.prevMatchInRange(e,0,i);return s||(s=this.prevMatchInRange(e,Math.max(0,n-this.spec.unquoted.length),e.doc.length)),s&&(s.from!=i||s.to!=n)?s:null}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,i){let n=A(this.spec,e,0,e.doc.length),s=[];for(;!n.next().done;){if(s.length>=i)return null;s.push(n.value)}return s}highlight(e,i,n,s){let r=A(this.spec,e,Math.max(0,i-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.doc.length));for(;!r.next().done;)s(r.value.from,r.value.to)}}function R(t,e,i,n){return new ke(e.doc,t.search,{ignoreCase:!t.caseSensitive,test:t.wholeWord?Mt(e.charCategorizer(e.selection.main.head)):void 0},i,n)}function N(t,e){return t.slice(ye(t,e,!1),e)}function _(t,e){return t.slice(e,ye(t,e))}function Mt(t){return(e,i,n)=>!n[0].length||(t(N(n.input,n.index))!=b.Word||t(_(n.input,n.index))!=b.Word)&&(t(_(n.input,n.index+n[0].length))!=b.Word||t(N(n.input,n.index+n[0].length))!=b.Word)}class wt extends Me{nextMatch(e,i,n){let s=R(this.spec,e,n,e.doc.length).next();return s.done&&(s=R(this.spec,e,0,i).next()),s.done?null:s.value}prevMatchInRange(e,i,n){for(let s=1;;s++){let r=Math.max(i,n-s*1e4),o=R(this.spec,e,r,n),l=null;for(;!o.next().done;)l=o.value;if(l&&(r==i||l.from>r+10))return l;if(r==i)return null}}prevMatch(e,i,n){return this.prevMatchInRange(e,0,i)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(i,n)=>{if(n=="&")return e.match[0];if(n=="$")return"$";for(let s=n.length;s>0;s--){let r=+n.slice(0,s);if(r>0&&r<e.match.length)return e.match[r]+n.slice(s)}return i})}matchAll(e,i){let n=R(this.spec,e,0,e.doc.length),s=[];for(;!n.next().done;){if(s.length>=i)return null;s.push(n.value)}return s}highlight(e,i,n,s){let r=R(this.spec,e,Math.max(0,i-250),Math.min(n+250,e.doc.length));for(;!r.next().done;)s(r.value.from,r.value.to)}}const q=M.define(),ie=M.define(),w=J.define({create(t){return new G(Y(t).create(),null)},update(t,e){for(let i of e.effects)i.is(q)?t=new G(i.value.create(),t.panel):i.is(ie)&&(t=new G(t.query,i.value?ne:null));return t},provide:t=>X.from(t,e=>e.panel)});class G{constructor(e,i){this.query=e,this.panel=i}}const Lt=p.mark({class:"cm-searchMatch"}),At=p.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Rt=ge.fromClass(class{constructor(t){this.view=t,this.decorations=this.highlight(t.state.field(w))}update(t){let e=t.state.field(w);(e!=t.startState.field(w)||t.docChanged||t.selectionSet||t.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:t,panel:e}){if(!e||!t.spec.valid)return p.none;let{view:i}=this,n=new xe;for(let s=0,r=i.visibleRanges,o=r.length;s<o;s++){let{from:l,to:a}=r[s];for(;s<o-1&&a>r[s+1].from-500;)a=r[++s].to;t.highlight(i.state,l,a,(h,c)=>{let f=i.state.selection.ranges.some(m=>m.from==h&&m.to==c);n.add(h,c,f?At:Lt)})}return n.finish()}},{decorations:t=>t.decorations});function $(t){return e=>{let i=e.state.field(w,!1);return i&&i.query.spec.valid?t(e,i):Ae(e)}}const Q=$((t,{query:e})=>{let{to:i}=t.state.selection.main,n=e.nextMatch(t.state,i,i);if(!n)return!1;let s=k.single(n.from,n.to),r=t.state.facet(F);return t.dispatch({selection:s,effects:[se(t,n),r.scrollToMatch(s.main,t)],userEvent:"select.search"}),Le(t),!0}),V=$((t,{query:e})=>{let{state:i}=t,{from:n}=i.selection.main,s=e.prevMatch(i,n,n);if(!s)return!1;let r=k.single(s.from,s.to),o=t.state.facet(F);return t.dispatch({selection:r,effects:[se(t,s),o.scrollToMatch(r.main,t)],userEvent:"select.search"}),Le(t),!0}),Dt=$((t,{query:e})=>{let i=e.matchAll(t.state,1e3);return!i||!i.length?!1:(t.dispatch({selection:k.create(i.map(n=>k.range(n.from,n.to))),userEvent:"select.search.matches"}),!0)}),Pt=({state:t,dispatch:e})=>{let i=t.selection;if(i.ranges.length>1||i.main.empty)return!1;let{from:n,to:s}=i.main,r=[],o=0;for(let l=new P(t.doc,t.sliceDoc(n,s));!l.next().done;){if(r.length>1e3)return!1;l.value.from==n&&(o=r.length),r.push(k.range(l.value.from,l.value.to))}return e(t.update({selection:k.create(r,o),userEvent:"select.search.matches"})),!0},he=$((t,{query:e})=>{let{state:i}=t,{from:n,to:s}=i.selection.main;if(i.readOnly)return!1;let r=e.nextMatch(i,n,n);if(!r)return!1;let o=r,l=[],a,h,c=[];o.from==n&&o.to==s&&(h=i.toText(e.getReplacement(o)),l.push({from:o.from,to:o.to,insert:h}),o=e.nextMatch(i,o.from,o.to),c.push(S.announce.of(i.phrase("replaced match on line $",i.doc.lineAt(n).number)+".")));let f=t.state.changes(l);return o&&(a=k.single(o.from,o.to).map(f),c.push(se(t,o)),c.push(i.facet(F).scrollToMatch(a.main,t))),t.dispatch({changes:f,selection:a,effects:c,userEvent:"input.replace"}),!0}),Wt=$((t,{query:e})=>{if(t.state.readOnly)return!1;let i=e.matchAll(t.state,1e9).map(s=>{let{from:r,to:o}=s;return{from:r,to:o,insert:e.getReplacement(s)}});if(!i.length)return!1;let n=t.state.phrase("replaced $ matches",i.length)+".";return t.dispatch({changes:i,effects:S.announce.of(n),userEvent:"input.replace.all"}),!0});function ne(t){return t.state.facet(F).createPanel(t)}function Y(t,e){var i,n,s,r,o;let l=t.selection.main,a=l.empty||l.to>l.from+100?"":t.sliceDoc(l.from,l.to);if(e&&!a)return e;let h=t.facet(F);return new Ce({search:((i=e?.literal)!==null&&i!==void 0?i:h.literal)?a:a.replace(/\n/g,"\\n"),caseSensitive:(n=e?.caseSensitive)!==null&&n!==void 0?n:h.caseSensitive,literal:(s=e?.literal)!==null&&s!==void 0?s:h.literal,regexp:(r=e?.regexp)!==null&&r!==void 0?r:h.regexp,wholeWord:(o=e?.wholeWord)!==null&&o!==void 0?o:h.wholeWord})}function we(t){let e=I(t,ne);return e&&e.dom.querySelector("[main-field]")}function Le(t){let e=we(t);e&&e==t.root.activeElement&&e.select()}const Ae=t=>{let e=t.state.field(w,!1);if(e&&e.panel){let i=we(t);if(i&&i!=t.root.activeElement){let n=Y(t.state,e.query.spec);n.valid&&t.dispatch({effects:q.of(n)}),i.focus(),i.select()}}else t.dispatch({effects:[ie.of(!0),e?q.of(Y(t.state,e.query.spec)):M.appendConfig.of(qt)]});return!0},Re=t=>{let e=t.state.field(w,!1);if(!e||!e.panel)return!1;let i=I(t,ne);return i&&i.dom.contains(t.root.activeElement)&&t.focus(),t.dispatch({effects:ie.of(!1)}),!0},Ft=[{key:"Mod-f",run:Ae,scope:"editor search-panel"},{key:"F3",run:Q,shift:V,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:Q,shift:V,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Re,scope:"editor search-panel"},{key:"Mod-Shift-l",run:Pt},{key:"Mod-Alt-g",run:ct},{key:"Mod-d",run:kt,preventDefault:!0}];class Et{constructor(e){this.view=e;let i=this.query=e.state.field(w).query.spec;this.commit=this.commit.bind(this),this.searchField=u("input",{value:i.search,placeholder:x(e,"Find"),"aria-label":x(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=u("input",{value:i.replace,placeholder:x(e,"Replace"),"aria-label":x(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=u("input",{type:"checkbox",name:"case",form:"",checked:i.caseSensitive,onchange:this.commit}),this.reField=u("input",{type:"checkbox",name:"re",form:"",checked:i.regexp,onchange:this.commit}),this.wordField=u("input",{type:"checkbox",name:"word",form:"",checked:i.wholeWord,onchange:this.commit});function n(s,r,o){return u("button",{class:"cm-button",name:s,onclick:r,type:"button"},o)}this.dom=u("div",{onkeydown:s=>this.keydown(s),class:"cm-search"},[this.searchField,n("next",()=>Q(e),[x(e,"next")]),n("prev",()=>V(e),[x(e,"previous")]),n("select",()=>Dt(e),[x(e,"all")]),u("label",null,[this.caseField,x(e,"match case")]),u("label",null,[this.reField,x(e,"regexp")]),u("label",null,[this.wordField,x(e,"by word")]),...e.state.readOnly?[]:[u("br"),this.replaceField,n("replace",()=>he(e),[x(e,"replace")]),n("replaceAll",()=>Wt(e),[x(e,"replace all")])],u("button",{name:"close",onclick:()=>Re(e),"aria-label":x(e,"close"),type:"button"},["×"])])}commit(){let e=new Ce({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:q.of(e)}))}keydown(e){Oe(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?V:Q)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),he(this.view))}update(e){for(let i of e.transactions)for(let n of i.effects)n.is(q)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(F).top}}function x(t,e){return t.state.phrase(e)}const B=30,z=/[\s\.,:;?!]/;function se(t,{from:e,to:i}){let n=t.state.doc.lineAt(e),s=t.state.doc.lineAt(i).to,r=Math.max(n.from,e-B),o=Math.min(s,i+B),l=t.state.sliceDoc(r,o);if(r!=n.from){for(let a=0;a<B;a++)if(!z.test(l[a+1])&&z.test(l[a])){l=l.slice(a);break}}if(o!=s){for(let a=l.length-1;a>l.length-B;a--)if(!z.test(l[a-1])&&z.test(l[a])){l=l.slice(0,a);break}}return S.announce.of(`${t.state.phrase("current match")}. ${l} ${t.state.phrase("on line")} ${n.number}.`)}const It=S.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),qt=[w,Ee.low(Rt),It];class fe{constructor(e,i,n){this.from=e,this.to=i,this.diagnostic=n}}class L{constructor(e,i,n){this.diagnostics=e,this.panel=i,this.selected=n}static init(e,i,n){let s=n.facet(T).markerFilter;s&&(e=s(e,n));let r=e.slice().sort((c,f)=>c.from-f.from||c.to-f.to),o=new xe,l=[],a=0;for(let c=0;;){let f=c==r.length?null:r[c];if(!f&&!l.length)break;let m,g;for(l.length?(m=a,g=l.reduce((d,v)=>Math.min(d,v.to),f&&f.from>m?f.from:1e8)):(m=f.from,g=f.to,l.push(f),c++);c<r.length;){let d=r[c];if(d.from==m&&(d.to>d.from||d.to==m))l.push(d),c++,g=Math.min(d.to,g);else{g=Math.min(d.from,g);break}}let C=Gt(l);if(l.some(d=>d.from==d.to||d.from==d.to-1&&n.doc.lineAt(d.from).to==d.from))o.add(m,m,p.widget({widget:new _t(C),diagnostics:l.slice()}));else{let d=l.reduce((v,oe)=>oe.markClass?v+" "+oe.markClass:v,"");o.add(m,g,p.mark({class:"cm-lintRange cm-lintRange-"+C+d,diagnostics:l.slice(),inclusiveEnd:l.some(v=>v.to>g)}))}a=g;for(let d=0;d<l.length;d++)l[d].to<=a&&l.splice(d--,1)}let h=o.finish();return new L(h,i,W(h))}}function W(t,e=null,i=0){let n=null;return t.between(i,1e9,(s,r,{spec:o})=>{if(!(e&&o.diagnostics.indexOf(e)<0))if(!n)n=new fe(s,r,e||o.diagnostics[0]);else{if(o.diagnostics.indexOf(n.diagnostic)<0)return!1;n=new fe(n.from,r,n.diagnostic)}}),n}function Tt(t,e){let i=e.pos,n=e.end||i,s=t.state.facet(T).hideOn(t,i,n);if(s!=null)return s;let r=t.startState.doc.lineAt(e.pos);return!!(t.effects.some(o=>o.is(De))||t.changes.touchesRange(r.from,Math.max(r.to,n)))}function Ot(t,e){return t.field(y,!1)?e:e.concat(M.appendConfig.of(Ut))}const De=M.define(),re=M.define(),Pe=M.define(),y=J.define({create(){return new L(p.none,null,null)},update(t,e){if(e.docChanged&&t.diagnostics.size){let i=t.diagnostics.map(e.changes),n=null,s=t.panel;if(t.selected){let r=e.changes.mapPos(t.selected.from,1);n=W(i,t.selected.diagnostic,r)||W(i,null,r)}!i.size&&s&&e.state.facet(T).autoPanel&&(s=null),t=new L(i,s,n)}for(let i of e.effects)if(i.is(De)){let n=e.state.facet(T).autoPanel?i.value.length?O.open:null:t.panel;t=L.init(i.value,n,e.state)}else i.is(re)?t=new L(t.diagnostics,i.value?O.open:null,t.selected):i.is(Pe)&&(t=new L(t.diagnostics,t.panel,i.value));return t},provide:t=>[X.from(t,e=>e.panel),S.decorations.from(t,e=>e.diagnostics)]}),$t=p.mark({class:"cm-lintRange cm-lintRange-active"});function Bt(t,e,i){let{diagnostics:n}=t.state.field(y),s,r=-1,o=-1;n.between(e-(i<0?1:0),e+(i>0?1:0),(a,h,{spec:c})=>{if(e>=a&&e<=h&&(a==h||(e>a||i>0)&&(e<h||i<0)))return s=c.diagnostics,r=a,o=h,!1});let l=t.state.facet(T).tooltipFilter;return s&&l&&(s=l(s,t.state)),s?{pos:r,end:o,above:t.state.doc.lineAt(r).to<o,create(){return{dom:zt(t,s)}}}:null}function zt(t,e){return u("ul",{class:"cm-tooltip-lint"},e.map(i=>Fe(t,i,!1)))}const Ht=t=>{let e=t.state.field(y,!1);(!e||!e.panel)&&t.dispatch({effects:Ot(t.state,[re.of(!0)])});let i=I(t,O.open);return i&&i.dom.querySelector(".cm-panel-lint ul").focus(),!0},ue=t=>{let e=t.state.field(y,!1);return!e||!e.panel?!1:(t.dispatch({effects:re.of(!1)}),!0)},Kt=t=>{let e=t.state.field(y,!1);if(!e)return!1;let i=t.state.selection.main,n=e.diagnostics.iter(i.to+1);return!n.value&&(n=e.diagnostics.iter(0),!n.value||n.from==i.from&&n.to==i.to)?!1:(t.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0}),!0)},Nt=[{key:"Mod-Shift-m",run:Ht,preventDefault:!0},{key:"F8",run:Kt}],T=Z.define({combine(t){return{sources:t.map(e=>e.source).filter(e=>e!=null),...ee(t.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{delay:Math.max,markerFilter:de,tooltipFilter:de,needsRefresh:(e,i)=>e?i?n=>e(n)||i(n):e:i,hideOn:(e,i)=>e?i?(n,s,r)=>e(n,s,r)||i(n,s,r):e:i,autoPanel:(e,i)=>e||i})}}});function de(t,e){return t?e?(i,n)=>e(t(i,n),n):t:e}function We(t){let e=[];if(t)e:for(let{name:i}of t){for(let n=0;n<i.length;n++){let s=i[n];if(/[a-zA-Z]/.test(s)&&!e.some(r=>r.toLowerCase()==s.toLowerCase())){e.push(s);continue e}}e.push("")}return e}function Fe(t,e,i){var n;let s=i?We(e.actions):[];return u("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},u("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage(t):e.message),(n=e.actions)===null||n===void 0?void 0:n.map((r,o)=>{let l=!1,a=g=>{if(g.preventDefault(),l)return;l=!0;let C=W(t.state.field(y).diagnostics,e);C&&r.apply(t,C.from,C.to)},{name:h}=r,c=s[o]?h.indexOf(s[o]):-1,f=c<0?h:[h.slice(0,c),u("u",h.slice(c,c+1)),h.slice(c+1)],m=r.markClass?" "+r.markClass:"";return u("button",{type:"button",class:"cm-diagnosticAction"+m,onclick:a,onmousedown:a,"aria-label":` Action: ${h}${c<0?"":` (access key "${s[o]})"`}.`},f)}),e.source&&u("div",{class:"cm-diagnosticSource"},e.source))}class _t extends Be{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return u("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}}class me{constructor(e,i){this.diagnostic=i,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=Fe(e,i,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class O{constructor(e){this.view=e,this.items=[];let i=s=>{if(s.keyCode==27)ue(this.view),this.view.focus();else if(s.keyCode==38||s.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(s.keyCode==40||s.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(s.keyCode==36)this.moveSelection(0);else if(s.keyCode==35)this.moveSelection(this.items.length-1);else if(s.keyCode==13)this.view.focus();else if(s.keyCode>=65&&s.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:r}=this.items[this.selectedIndex],o=We(r.actions);for(let l=0;l<o.length;l++)if(o[l].toUpperCase().charCodeAt(0)==s.keyCode){let a=W(this.view.state.field(y).diagnostics,r);a&&r.actions[l].apply(e,a.from,a.to)}}else return;s.preventDefault()},n=s=>{for(let r=0;r<this.items.length;r++)this.items[r].dom.contains(s.target)&&this.moveSelection(r)};this.list=u("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:i,onclick:n}),this.dom=u("div",{class:"cm-panel-lint"},this.list,u("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>ue(this.view)},"×")),this.update()}get selectedIndex(){let e=this.view.state.field(y).selected;if(!e)return-1;for(let i=0;i<this.items.length;i++)if(this.items[i].diagnostic==e.diagnostic)return i;return-1}update(){let{diagnostics:e,selected:i}=this.view.state.field(y),n=0,s=!1,r=null,o=new Set;for(e.between(0,this.view.state.doc.length,(l,a,{spec:h})=>{for(let c of h.diagnostics){if(o.has(c))continue;o.add(c);let f=-1,m;for(let g=n;g<this.items.length;g++)if(this.items[g].diagnostic==c){f=g;break}f<0?(m=new me(this.view,c),this.items.splice(n,0,m),s=!0):(m=this.items[f],f>n&&(this.items.splice(n,f-n),s=!0)),i&&m.diagnostic==i.diagnostic?m.dom.hasAttribute("aria-selected")||(m.dom.setAttribute("aria-selected","true"),r=m):m.dom.hasAttribute("aria-selected")&&m.dom.removeAttribute("aria-selected"),n++}});n<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)s=!0,this.items.pop();this.items.length==0&&(this.items.push(new me(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),s=!0),r?(this.list.setAttribute("aria-activedescendant",r.id),this.view.requestMeasure({key:this,read:()=>({sel:r.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:l,panel:a})=>{let h=a.height/this.list.offsetHeight;l.top<a.top?this.list.scrollTop-=(a.top-l.top)/h:l.bottom>a.bottom&&(this.list.scrollTop+=(l.bottom-a.bottom)/h)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),s&&this.sync()}sync(){let e=this.list.firstChild;function i(){let n=e;e=n.nextSibling,n.remove()}for(let n of this.items)if(n.dom.parentNode==this.list){for(;e!=n.dom;)i();e=n.dom.nextSibling}else this.list.insertBefore(n.dom,e);for(;e;)i()}moveSelection(e){if(this.selectedIndex<0)return;let i=this.view.state.field(y),n=W(i.diagnostics,this.items[e].diagnostic);n&&this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:Pe.of(n)})}static open(e){return new O(e)}}function Qt(t,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(t)}</svg>')`}function H(t){return Qt(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${t}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const Vt=S.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:H("#d11")},".cm-lintRange-warning":{backgroundImage:H("orange")},".cm-lintRange-info":{backgroundImage:H("#999")},".cm-lintRange-hint":{backgroundImage:H("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function jt(t){return t=="error"?4:t=="warning"?3:t=="info"?2:1}function Gt(t){let e="hint",i=1;for(let n of t){let s=jt(n.severity);s>i&&(i=s,e=n.severity)}return e}const Ut=[y,S.decorations.compute([y],t=>{let{selected:e,panel:i}=t.field(y);return!e||!i||e.from==e.to?p.none:p.set([$t.range(e.from,e.to)])}),$e(Bt,{hideOn:Tt}),Vt],Jt=[ze(),He(),Ke(),Ne(),_e(),Qe(),Ve(),pe.allowMultipleSelections.of(!0),je(),Ge(it,{fallback:!0}),Ue(),Ye(),Je(),Ze(),Xe(),et(),dt(),tt.of([...nt,...st,...Ft,...rt,...ot,...lt,...Nt])];export{Jt as b};
